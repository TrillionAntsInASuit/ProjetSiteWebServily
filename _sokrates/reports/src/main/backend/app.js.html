<html>
<head>
    <title>backend/app.js</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">backend/app.js (<b>50</b> lines of code) (<a href="app.js">raw</a>):</h3>
<div id="editor">import express from &quot;express&quot;;
import errorHandler from &quot;./handler/error-handler.js&quot;;
import usersRoutes from &quot;./routes/users-routes.js&quot;;
import cors from &quot;cors&quot;;
import dotenv from &quot;dotenv&quot;;
import { createCheckoutSession, handleStripeWebhook } from &quot;./routes/stripe.js&quot;;

dotenv.config();
console.log(&quot;âœ… App starting...&quot;);
console.log(&quot;Stripe key:&quot;, process.env.STRIPE_SECRET_KEY);
const app = express();
const PORT = process.env.PORT || 5000;

const allowedOrigins = [
  &quot;https://projetwebservily-hicq.vercel.app&quot;,
  &quot;http://localhost:5173&quot;,
];

app.use((req, res, next) =&gt; {
  const origin = req.headers.origin;
  console.log(&quot;Request Origin:&quot;, origin, &quot;Method:&quot;, req.method);
  if (allowedOrigins.includes(origin)) {
    res.setHeader(&quot;Access-Control-Allow-Origin&quot;, origin);
    res.setHeader(&quot;Access-Control-Allow-Credentials&quot;, &quot;true&quot;);
    res.setHeader(
      &quot;Access-Control-Allow-Methods&quot;,
      &quot;GET, POST, PUT, DELETE, OPTIONS&quot;
    );
    res.setHeader(
      &quot;Access-Control-Allow-Headers&quot;,
      &quot;Content-Type, Authorization&quot;
    );
  }

  if (req.method === &quot;OPTIONS&quot;) {
    return res.status(200).end();
  }

  next();
});

app.post(
  &quot;/webhook&quot;,
  express.raw({ type: &quot;application/json&quot; }),
  handleStripeWebhook
);

app.use(express.json());

app.post(&quot;/create-checkout-session&quot;, createCheckoutSession);

app.use(&quot;/api/users&quot;, usersRoutes);

app.use((req, res, next) =&gt; {
  const error = new Error(&quot;Route non trouv&eacute;e&quot;);
  error.code = 404;
  next(error);
});

app.use(errorHandler);

/*app.listen(5000, () =&gt; {
  console.log(&quot;serveur &eacute;coute au&quot;, `http://localhost:${PORT}`);
});*/
export default app;
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/javascript");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
